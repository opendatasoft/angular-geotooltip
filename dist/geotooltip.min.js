!function(){"use strict";angular.module("geotooltip",[]).provider("GeoTooltipConfig",function(){this.defaultConfig={tiles:"http://otile{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.png",subdomains:"1234",attribution:'Tiles <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png"> - Map data Â© <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a>',defaultDelay:500,defaultWidth:200,defaultHeight:200,maxZoom:16},this.setConfig=function(a){this.customConfig=a},this.$get=function(){return angular.extend({},this.defaultConfig,this.customConfig)}}).directive("geotooltip",["$timeout","GeoTooltipConfig",function(a,b){var c=angular.element('<div id="geotooltip" style="opacity: 0; transition: opacity 200ms ease-out; position: fixed; z-index: 40000; visibility: hidden;"></div>'),d=null,e=null,f=function(a,f,g,h,i){var j=!1;(f!==c.css("width")||g!==c.css("height"))&&(j=!0),c.css("width",f),c.css("height",g);var k=jQuery(window).height()-(a.offset().top-jQuery(document).scrollTop());c.height()<k?c.css("top",a.height()+a.offset().top-jQuery(document).scrollTop()+5+"px"):c.css("top",a.offset().top-jQuery(document).scrollTop()-5-c.height()+"px");var l=jQuery(window).width()-(a.offset().left-jQuery(document).scrollLeft());if(c.width()<l?c.css("left",a.offset().left-jQuery(document).scrollLeft()+"px"):c.css("left",a.offset().left-jQuery(document).scrollLeft()-c.width()+"px"),a.after(c),null===d){d=new L.map(c[0],{zoomControl:!1});var m=new L.TileLayer(b.tiles,{minZoom:1,maxZoom:b.maxZoom,attribution:b.attribution,subdomains:b.subdomains});d.addLayer(m)}else j&&d.invalidateSize();null!==e&&d.removeLayer(e),e=L.layerGroup();var n=new L.LatLngBounds;if(h){angular.isString(h)&&(h=h.split(","));var o=new L.LatLng(h[0],h[1]),p=L.marker(o);e.addLayer(p),n.extend(o)}if(i){angular.isString(i)&&(i=angular.fromJson(i));var q=L.geoJson(i);e.addLayer(q),n.extend(q.getBounds())}e.addTo(d),d.fitBounds(n,{reset:!0}),c.css("opacity","1"),c.css("visibility","visible")},g=function(){c.css("opacity","0"),a(function(){c.css("visibility","hidden")},200)};return{template:'<span ng-transclude style="border-bottom: 1px dotted #000000; cursor: help;" class="geotooltip"></span>',replace:!0,restrict:"E",transclude:!0,scope:{coords:"=",width:"@",height:"@",delay:"@",geojson:"="},link:function(c,d,e){var h=(e.width||b.defaultWidth)+"px",i=(e.height||b.defaultHeight)+"px",j=null,k=e.delay||b.defaultDelay;d.bind("mouseenter",function(){0===k?f(d,h,i,c.coords,c.geojson):j=a(function(){f(d,h,i,c.coords,c.geojson),j=null},k)}),d.bind("click",function(){f(d,h,i,c.coords,c.geojson),null!==j&&(a.cancel(j),j=null)}),d.bind("mouseleave",function(){console.log("mouseout"),g(),null!==j&&(a.cancel(j),j=null)})}}}])}();